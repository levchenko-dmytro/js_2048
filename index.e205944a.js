class e{constructor(e,t,l){let i=document.createElement("div");i.classList.add("cell"),e.append(i),this.x=t,this.y=l}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkTile(){this.linkedTile=null}isEmpty(){return!this.linkedTile}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}hasTileForMerge(){return this.linkedTileForMerge}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}mergeTiles(){this.linkedTile.setValue(2*this.linkedTile.value),this.linkedTile.removeClassList(),this.linkedTileForMerge.removeFromDOM(),this.unlinkTileForMerge()}getCellValue(){return this.linkedTile?this.linkedTile.getTileValue():0}}class t{constructor(e){this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),this.setValue(Math.random()>=.9?4:2),e.append(this.tileElement)}setXY(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}setValue(e){this.value=e,this.tileElement.textContent=this.value,this.tileElement.classList.add(`tile--${e}`)}removeFromDOM(){this.tileElement.remove()}removeClassList(){this.tileElement.classList.remove(`tile--${this.value/2}`)}getTileValue(){return this.value}waitForTransitionEnd(){return new Promise(e=>{this.tileElement.addEventListener("transitionend",e,{once:!0})})}}let l=0;const i=document.querySelector(".button"),s=document.querySelector(".game-score"),n=document.querySelector(".message-start"),r=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),a=document.querySelector(".game-board"),c=new class{constructor(t){this.cells=[];for(let l=0;l<16;l++)this.cells.push(new e(t,l%4,Math.floor(l/4)));this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(e=>[...e].reverse()),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}}(a);function u(){c.cells.forEach(e=>{e.isEmpty()||(e.linkedTile.removeFromDOM(),e.unlinkTile())}),l=0,s.textContent=l,r.classList.add("hidden"),o.classList.add("hidden"),c.getRandomEmptyCell().linkTile(new t(a)),c.getRandomEmptyCell().linkTile(new t(a)),d()}function d(){window.addEventListener("keydown",m,{once:!0})}async function m(e){switch(e.key){case"ArrowUp":if(!w()){d();return}await h();break;case"ArrowDown":if(!g()){d();return}await y();break;case"ArrowLeft":if(!E()){d();return}await p();break;case"ArrowRight":if(!v()){d();return}await k();break;default:d();return}let l=new t(a);c.getRandomEmptyCell().linkTile(l),w()||g()||E()||v()||r.classList.remove("hidden"),d()}async function h(){await T(c.cellsGroupedByColumn)}async function y(){await T(c.cellsGroupedByReversedColumn)}async function p(){await T(c.cellsGroupedByRow)}async function k(){await T(c.cellsGroupedByReversedRow)}async function T(e){let t=[];e.forEach(e=>(function(e,t){for(let l=1;l<e.length;l++){let i;if(e[l].isEmpty())continue;let s=e[l],n=l-1;for(;n>=0&&e[n].canAccept(s.linkedTile);)i=e[n],n--;i&&(t.push(s.linkedTile.waitForTransitionEnd()),i.isEmpty()?i.linkTile(s.linkedTile):i.linkTileForMerge(s.linkedTile),s.unlinkTile())}})(e,t)),await Promise.all(t),c.cells.forEach(e=>{e.hasTileForMerge()&&(e.mergeTiles(),l+=e.getCellValue(),s.textContent=l),2048===e.getCellValue()&&o.classList.remove("hidden")})}function w(){return f(c.cellsGroupedByColumn)}function g(){return f(c.cellsGroupedByReversedColumn)}function E(){return f(c.cellsGroupedByRow)}function v(){return f(c.cellsGroupedByReversedRow)}function f(e){return e.some(e=>e.some((t,l)=>!(!l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile)))}i.addEventListener("click",function e(){d(),c.getRandomEmptyCell().linkTile(new t(a)),c.getRandomEmptyCell().linkTile(new t(a)),n.classList.add("hidden"),i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart",i.removeEventListener("click",e),i.addEventListener("click",u)});
//# sourceMappingURL=index.e205944a.js.map
